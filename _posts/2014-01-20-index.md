---
layout: post
title:  localhostに繋がらなくなって焦った。
date:   2014-01-20
categories: etc
---

仕事では、gruntでlocalhostにつなげて仕事をしているのだけれど、急にlocalhostが繋がらなくなってどないしようかと思った。

再起動しても変わらんし、ググってもApatchがどーのーこーのとしか出てこなくて、嫌な汗が出てきた。とりあえず以下のことをやってみた。


###やってみたこと
1.gruntを見返してみる。しかし、特に最近変更とかしてないので急におかしくなるとかちょっと考えにくい。

2.ビルドしてみると、普通にビルドできた。むむう。

3.とりあえずgrunt-contrib-connectをコメントアウトしてwatchしてみる。

4.一度、cssを編集すると見たことないエラーが表示された！

```
/node_modules/grunt-contrib-compass/node_modules/tmp/lib/tmp.js:261
  throw err;
        ^
Error: spawn EMFILE
```
こいつか！


ググってみると、

[styledoccoで"Error: spawn EMFILE"](http://blog.obentoba.co/entry/2013/12/25/styledocco-error)

こちらの記事を発見！ワオ！

どうやら一度に開けるファイル数制限にかかってしまったらしい。
そういや、ちょうど繋がらなくなる直前に、大量に画像を保存したわ。。。。

画像が開発用のディレクトリに保存されたら、リリース用のディレクトリにコピーするようにしてるから、その画像のファイル数が限界超えたので、繋がらなくなったのね。。。


さっそく、記事に書いていたように、

```
ulimit -n 1000
```

と叩いて見ると

```
open files                      (-n) 1000
```

と出てきて、最初にコメントアウトしていた、grunt-contrib-connectを復活させて、gruntをwatchさせて見ると、無事つながった！！！！ブラボー！！！


いやー、仕事進んでほっとした！


###そして現状

とりあえず今は、1000を上限にしているけれど、またファイルが増えて「繋がらない！」となるのもちょっと困る。
画像はリリース用のディレクトリに保存してwatchさせないようにするとか、ちょっと手段を講じる必要があるな。。





